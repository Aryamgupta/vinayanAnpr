{"ast":null,"code":"import React,{useEffect,useRef,useState}from\"react\";import zoomImg from\"./Images/zoom.png\";import minus from\"./Images/minux.png\";import plus from\"./Images/plus.png\";import\"./dashboards.css\";import axios from\"axios\";import{NavLink}from\"react-router-dom\";import{AllState}from\"Components/Context/Context\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const Camera=()=>{const{getRois,roiDatas}=AllState();// const [isFullscreen, setIsFullscreen] = useState(false);\nconst[zoom,setZoom]=useState(0.5);const[imgDimensions,setImgDimensions]=useState({});const canvasRef=useRef(null);const roiCanvasRef=useRef(null);useEffect(()=>{getRois();},[]);// const loadCamera = async function () {\n//   try {\n//     const { data } = await axios.get(`http://localhost:5000/video_feed`);\n//     console.log(data);\n//   } catch (error) {\n//     console.log(error);\n//   }\n// };\nconst zoomFunc=async function(zoom){try{const body={zoom:zoom,tilt:1,pan:1};const{data}=await axios.post(\"http://localhost:5001/ptz\",body);setZoom(parseFloat(data.zoom));console.log(data);}catch(error){console.log(error);}};// const toggleFullscreen = () => {\n//   setIsFullscreen(!isFullscreen);\n// };\nuseEffect(()=>{const canvas=canvasRef.current;const ctx=canvas.getContext(\"2d\");// const roiCanvas = roiCanvasRef.current;\n// const roiCtx = roiCanvas.getContext(\"2d\");\nconst socket=new WebSocket(\"ws://192.168.1.16:5001\");socket.onmessage=event=>{const blob=new Blob([event.data],{type:\"image/jpeg\"});const url=URL.createObjectURL(blob);const img=new Image();img.onload=()=>{canvas.width=img.width;canvas.height=img.height;if(img.width!==imgDimensions.width||img.height!==imgDimensions.height){setImgDimensions({height:img.height,width:img.width});}//  drawRoIs(roiCtx,roiCanvas)\nctx.drawImage(img,0,0);URL.revokeObjectURL(url);};img.src=url;};return()=>{socket.close();};},[roiDatas]);const drawRoIs=()=>{// Clear previous RoIs if needed\nconst roiCanvas=roiCanvasRef.current;roiCanvas.height=720;roiCanvas.width=1280;const roiCtx=roiCanvas.getContext(\"2d\");roiCtx.clearRect(0,0,roiCanvas.width,roiCanvas.height);roiDatas.forEach(roi=>{const roiData=JSON.parse(roi.roi_json).roi_json;roiCtx.strokeStyle=roi.roi_color;roiCtx.lineWidth=2;const points=[];const coordinates=roiData.coordinates;if(coordinates){for(const property in coordinates){const[x,y]=coordinates[property];points.push([x,y]);}roiCtx.beginPath();roiCtx.font=\"15px Arial\";roiCtx.fillText(\"\".concat(roi.roi_name),points[0][0],points[0][1]);// roiCtx.moveTo(points[0][1], points[0][0]);\n// roiCtx.lineTo(points[0][1]+50, points[0][0]+50);\nroiCtx.stroke();if(points.length>0){roiCtx.moveTo(points[0][0],points[0][1]);for(let i=0;i<points.length;i++){for(let j=0;j<2;j++){roiCtx.lineTo(points[i][0],points[i][1]);}}roiCtx.closePath();roiCtx.stroke();}}else{console.warn(\"No coordinates found in roiData:\",roiData);}});};useEffect(()=>{// const roiCanvas = roiCanvasRef.current;\ndrawRoIs();},[roiDatas]);return/*#__PURE__*/_jsxs(\"div\",{className:\"mainScreen\",children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"canvasContainer\",children:[/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{position:\"absolute\",zIndex:1}}),/*#__PURE__*/_jsx(\"canvas\",{ref:roiCanvasRef,style:{position:\"absolute\",zIndex:2,pointerEvents:\"none\"}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"zoomInBtnsDiv\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"genrateRoiBtn\",children:/*#__PURE__*/_jsx(NavLink,{to:\"/roiPart\",children:\"Generate RoI\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(zoom!==0){let z=zoom-0.05;zoomFunc(z);}},disabled:zoom===0,children:/*#__PURE__*/_jsx(\"img\",{src:minus,alt:\"Zoom Out\"})}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"img\",{src:zoomImg,alt:\"Zoom\"}),\"Zoom\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{if(zoom!==1){let z=zoom+0.05;zoomFunc(z);}},disabled:zoom===1,children:/*#__PURE__*/_jsx(\"img\",{src:plus,alt:\"Zoom In\"})})]})]})]});};","map":{"version":3,"names":["React","useEffect","useRef","useState","zoomImg","minus","plus","axios","NavLink","AllState","jsx","_jsx","jsxs","_jsxs","Camera","getRois","roiDatas","zoom","setZoom","imgDimensions","setImgDimensions","canvasRef","roiCanvasRef","zoomFunc","body","tilt","pan","data","post","parseFloat","console","log","error","canvas","current","ctx","getContext","socket","WebSocket","onmessage","event","blob","Blob","type","url","URL","createObjectURL","img","Image","onload","width","height","drawImage","revokeObjectURL","src","close","drawRoIs","roiCanvas","roiCtx","clearRect","forEach","roi","roiData","JSON","parse","roi_json","strokeStyle","roi_color","lineWidth","points","coordinates","property","x","y","push","beginPath","font","fillText","concat","roi_name","stroke","length","moveTo","i","j","lineTo","closePath","warn","className","children","ref","style","position","zIndex","pointerEvents","to","onClick","z","disabled","alt"],"sources":["/home/aryam/Videos/app/src/Components/Pages/Dashboard/Camera.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport zoomImg from \"./Images/zoom.png\";\nimport minus from \"./Images/minux.png\";\nimport plus from \"./Images/plus.png\";\nimport \"./dashboards.css\";\nimport axios from \"axios\";\nimport { NavLink } from \"react-router-dom\";\nimport { AllState } from \"Components/Context/Context\";\n\nexport const Camera = () => {\n  const { getRois, roiDatas } = AllState();\n  // const [isFullscreen, setIsFullscreen] = useState(false);\n  const [zoom, setZoom] = useState(0.5);\n  const [imgDimensions, setImgDimensions] = useState({});\n\n  const canvasRef = useRef(null);\n  const roiCanvasRef = useRef(null);\n\n  useEffect(() => {\n    getRois();\n  }, []);\n\n  // const loadCamera = async function () {\n  //   try {\n  //     const { data } = await axios.get(`http://localhost:5000/video_feed`);\n  //     console.log(data);\n  //   } catch (error) {\n  //     console.log(error);\n  //   }\n  // };\n\n  const zoomFunc = async function (zoom) {\n    try {\n      const body = {\n        zoom: zoom,\n        tilt: 1,\n        pan: 1,\n      };\n\n      const { data } = await axios.post(`http://localhost:5001/ptz`, body);\n      setZoom(parseFloat(data.zoom));\n      console.log(data);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  // const toggleFullscreen = () => {\n  //   setIsFullscreen(!isFullscreen);\n  // };\n\n    useEffect(() => {\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext(\"2d\");\n      // const roiCanvas = roiCanvasRef.current;\n      // const roiCtx = roiCanvas.getContext(\"2d\");\n\n      const socket = new WebSocket(\"ws://192.168.1.16:5001\");\n\n      socket.onmessage = (event) => {\n        const blob = new Blob([event.data], { type: \"image/jpeg\" });\n        const url = URL.createObjectURL(blob);\n\n        const img = new Image();\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          if (\n            img.width !== imgDimensions.width ||\n            img.height !== imgDimensions.height\n          ) {\n            setImgDimensions({ height: img.height, width: img.width });\n          }\n          //  drawRoIs(roiCtx,roiCanvas)\n          ctx.drawImage(img, 0, 0);\n          URL.revokeObjectURL(url);\n        };\n        img.src = url;\n      };\n\n      return () => {\n        socket.close();\n      };\n    }, [roiDatas]);\n\n  const drawRoIs = () => {\n    // Clear previous RoIs if needed\n    const roiCanvas = roiCanvasRef.current;\n    roiCanvas.height = 720;\n    roiCanvas.width = 1280;\n    const roiCtx = roiCanvas.getContext(\"2d\");\n\n    roiCtx.clearRect(0, 0, roiCanvas.width, roiCanvas.height);\n\n    roiDatas.forEach((roi) => {\n      const roiData = JSON.parse(roi.roi_json).roi_json;\n      roiCtx.strokeStyle = roi.roi_color;\n      roiCtx.lineWidth = 2;\n\n      const points = [];\n      const coordinates = roiData.coordinates;\n\n      if (coordinates) {\n        for (const property in coordinates) {\n          const [x, y] = coordinates[property];\n          points.push([x, y]);\n        }\n        roiCtx.beginPath();\n        roiCtx.font = \"15px Arial\";\n        roiCtx.fillText(`${roi.roi_name}`, points[0][0], points[0][1]);\n        // roiCtx.moveTo(points[0][1], points[0][0]);\n        // roiCtx.lineTo(points[0][1]+50, points[0][0]+50);\n        roiCtx.stroke();\n        if (points.length > 0) {\n          roiCtx.moveTo(points[0][0], points[0][1]);\n          for (let i = 0; i < points.length; i++) {\n            for (let j = 0; j < 2; j++) {\n              roiCtx.lineTo(points[i][0], points[i][1]);\n            }\n          }\n          roiCtx.closePath();\n          roiCtx.stroke();\n        }\n      } else {\n        console.warn(\"No coordinates found in roiData:\", roiData);\n      }\n    });\n  };\n\n  useEffect(() => {\n    // const roiCanvas = roiCanvasRef.current;\n    drawRoIs();\n  }, [roiDatas]);\n\n  return (\n    <div className=\"mainScreen\">\n      <div></div>\n      <div className=\"canvasContainer\">\n        <canvas\n          ref={canvasRef}\n          style={{\n            position: \"absolute\",\n\n            zIndex: 1,\n          }}\n        ></canvas>\n        <canvas\n          ref={roiCanvasRef}\n          style={{\n            position: \"absolute\",\n\n            zIndex: 2,\n            pointerEvents: \"none\",\n          }}\n        ></canvas>\n      </div>\n      <div className=\"zoomInBtnsDiv\">\n        <button className=\"genrateRoiBtn\">\n          <NavLink to=\"/roiPart\">Generate RoI</NavLink>\n        </button>\n        <div>\n          <button\n            onClick={() => {\n              if (zoom !== 0) {\n                let z = zoom - 0.05;\n                zoomFunc(z);\n              }\n            }}\n            disabled={zoom === 0}\n          >\n            <img src={minus} alt=\"Zoom Out\" />\n          </button>\n          <label>\n            <img src={zoomImg} alt=\"Zoom\" />\n            Zoom\n          </label>\n          <button\n            onClick={async () => {\n              if (zoom !== 1) {\n                let z = zoom + 0.05;\n                zoomFunc(z);\n              }\n            }}\n            disabled={zoom === 1}\n          >\n            <img src={plus} alt=\"Zoom In\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}